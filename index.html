<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Expense Tracker</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: #333;
        }

        :root {
            --vh: 1vh;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            text-align: center;
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-box h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .login-box p {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .login-form {
            text-align: left;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .login-form input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
        }

        .login-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .login-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 10px;
        }

        .user-welcome {
            font-weight: 600;
            color: #333;
        }

        .logout-btn {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: none;
            overflow: hidden;
        }

        .container.show {
            display: block;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.6s ease-out;
            max-width: 100%;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 6px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .month-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            max-width: 100%;
        }

        .month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .month-selector label {
            color: #333;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .date-selectors {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .month-select, .year-select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            color: #333;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        .month-select:focus, .year-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .month-select:hover, .year-select:hover {
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .current-month-display {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            margin-top: 10px;
            display: inline-block;
        }

        .month-navigation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .nav-btn.prev {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .nav-btn.prev:hover {
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }

        .nav-btn.next {
            background: linear-gradient(45deg, #007bff, #0056b3);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .nav-btn.next:hover {
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.4);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: all 0.3s ease;
            border-left: 5px solid;
            animation: fadeInUp 0.5s ease-out;
            max-width: 100%;
            overflow: hidden;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-card.salary { border-left-color: #4CAF50; }
        .stat-card.expense { border-left-color: #f44336; }
        .stat-card.savings { border-left-color: #2196F3; }
        .stat-card.balance { border-left-color: #FF9800; }

        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }

        .stat-card .amount {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            transition: all 0.3s ease;
            word-break: break-all;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .tabs-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            max-width: 100%;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 120px;
        }

        .tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .tab-content {
            padding: 30px;
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background: white;
            box-sizing: border-box;
        }

        .form-group select {
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .subcategory-select {
            margin-top: 10px;
            display: none;
        }

        .subcategory-select.show {
            display: block;
        }

        .btn {
            width: 100%;
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-sizing: border-box;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .charts-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            overflow: hidden;
        }

        .charts-container h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
            font-size: 1.3rem;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .expenses-list {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-top: 25px;
            max-width: 100%;
            overflow: hidden;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            animation: slideInRight 0.4s ease-out;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .expense-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .expense-item.paid {
            opacity: 0.7;
            background: #d4edda;
            border-left-color: #28a745;
        }

        .expense-details {
            flex: 1;
            margin-right: 15px;
        }

        .expense-desc {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            word-wrap: break-word;
        }

        .expense-category {
            font-size: 0.85rem;
            color: #666;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
            margin-bottom: 5px;
        }

        .expense-subcategory {
            font-size: 0.8rem;
            color: #888;
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
            margin-left: 5px;
        }

        .expense-amount {
            color: #f44336;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .expense-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 0.8rem;
            width: auto;
            min-width: 80px;
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: calc(100vw - 40px);
            word-wrap: break-word;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .notification.error {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.8s ease-out;
            max-width: 100%;
            overflow: hidden;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .footer-main {
            font-size: 1.4rem;
            font-weight: 700;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .heart {
            color: #e74c3c;
            font-size: 1.6rem;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.1); }
            28% { transform: scale(1); }
            42% { transform: scale(1.1); }
            70% { transform: scale(1); }
        }

        .developer-name {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .developer-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 30px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .developer-info:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .developer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .developer-details {
            text-align: left;
        }

        .developer-title {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Database Status Indicator */
        .db-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .db-status.connected {
            color: #28a745;
        }

        .db-status.disconnected {
            color: #dc3545;
        }

        .db-status i {
            font-size: 1rem;
        }

            /* Update existing media queries for better mobile layout */
@media (max-width: 1200px) {
    .main-content {
        grid-template-columns: 1fr; /* Keep single column for simplicity, but enhance child layouts */
        gap: 20px;
    }

    .dashboard-grid {
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); /* Allow cards to wrap naturally */
        gap: 15px;
    }

    .tabs {
        display: flex;
        flex-wrap: nowrap; /* Prevent tabs from stacking */
        overflow-x: auto; /* Allow horizontal scrolling for tabs */
    }

    .tab {
        flex: 0 0 auto; /* Prevent tabs from stretching */
        min-width: 100px; /* Ensure tabs are compact but readable */
        padding: 12px;
    }
}

@media (max-width: 768px) {
    .container {
        padding: 15px !important;
        margin: 0 auto !important;
        max-width: 100%;
    }

    .login-box {
        padding: 25px 15px;
        margin: 10px;
        border-radius: 15px;
    }

    .header h1 {
        font-size: 1.8rem !important;
    }

    .header p {
        font-size: 0.95rem !important;
    }

    .dashboard-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Smaller cards for mobile */
        gap: 12px;
    }

    .stat-card {
        padding: 15px !important;
        margin-bottom: 10px;
        border-radius: 10px;
    }

    .stat-card .amount {
        font-size: 1.4rem !important;
    }

    .tabs {
        flex-direction: row !important; /* Keep tabs horizontal */
        overflow-x: auto;
        white-space: nowrap;
    }

    .tab {
        padding: 10px !important;
        font-size: 0.85rem !important;
        min-width: 90px !important; /* Compact tabs */
        text-align: center;
    }

    .tab-content {
        padding: 15px !important;
    }

    .charts-container {
        padding: 15px !important;
    }

    .chart-wrapper {
        height: 220px !important; /* Slightly smaller charts for mobile */
    }

    .expense-item {
        flex-direction: row !important; /* Keep expense items in a row where possible */
        align-items: center !important;
        gap: 10px;
        padding: 12px !important;
        flex-wrap: wrap; /* Allow wrapping for long content */
    }

    .expense-details {
        flex: 1;
        margin-right: 10px !important;
        min-width: 150px; /* Ensure details don't get too cramped */
    }

    .expense-actions {
        flex: 0 0 auto;
        justify-content: flex-end;
        gap: 5px;
    }

    .month-selector {
        flex-direction: row; /* Keep month selector horizontal */
        flex-wrap: wrap;
        gap: 10px;
    }

    .date-selectors {
        flex-direction: row !important; /* Horizontal date selectors */
        flex-wrap: wrap;
        gap: 8px;
    }

    .month-select, .year-select {
        min-width: 120px !important; /* Compact but usable */
    }

    .month-navigation {
        flex-direction: row !important; /* Horizontal navigation buttons */
        gap: 8px;
        flex-wrap: wrap;
    }

    .notification {
        top: 10px !important;
        right: 10px !important;
        left: auto !important;
        max-width: 300px;
        padding: 10px 15px !important;
        font-size: 0.85rem !important;
    }

    .notification.show {
        transform: translateX(0) !important;
    }

    .footer {
        padding: 15px !important;
    }

    .footer-main {
        font-size: 1rem !important;
        flex-wrap: wrap;
    }

    .developer-info {
        flex-direction: row !important;
        padding: 12px 15px !important;
    }

    .developer-details {
        text-align: left !important;
    }

    .user-info {
        flex-direction: row !important;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }

    .db-status {
        bottom: 10px !important;
        left: 10px !important;
        font-size: 0.75rem !important;
        padding: 6px 10px !important;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 10px !important;
    }

    .dashboard-grid {
        grid-template-columns: 1fr !important; /* Stack cards for very small screens */
        gap: 10px;
    }

    .stat-card {
        padding: 12px !important;
    }

    .stat-card i {
        font-size: 1.8rem !important;
    }

    .stat-card .amount {
        font-size: 1.2rem !important;
    }

    .btn {
        padding: 10px 15px !important;
        font-size: 0.85rem !important;
    }

    .form-group input, .form-group select {
        padding: 10px !important;
        font-size: 0.85rem !important;
    }

    .login-box {
        padding: 15px 10px !important;
        margin: 5px;
    }

    .tab-content {
        padding: 12px !important;
    }

    .charts-container {
        padding: 12px !important;
    }

    .expense-item {
        flex-direction: column !important; /* Stack for very small screens */
        padding: 10px !important;
    }

    .expense-details {
        margin-bottom: 8px !important;
    }

    .footer {
        padding: 12px !important;
    }
}
        }
    </style>
</head>
<body>
    <!-- Database Status Indicator -->
    <div id="dbStatus" class="db-status disconnected">
        <i class="fas fa-database"></i>
        <span id="dbStatusText">Connecting...</span>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h1><i class="fas fa-wallet"></i> Expense Tracker</h1>
            <p>Secure login to manage your finances</p>
            
            <div class="login-tabs">
                <button class="login-tab active" onclick="switchLoginTab('login')">Login</button>
                <button class="login-tab" onclick="switchLoginTab('register')">Register</button>
            </div>

            <form class="login-form" id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <div class="form-group" id="emailGroup" style="display: none;">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email">
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> <span id="submitText">Login</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div class="container" id="mainApp">
        <div class="user-info">
            <div class="user-welcome">
                <i class="fas fa-user-circle"></i> Welcome, <span id="currentUser"></span>!
            </div>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <div class="header">
            <h1><i class="fas fa-chart-line"></i> Expense Tracker</h1>
            <p>Advanced financial management with analytics and insights</p>
        </div>

        <div class="month-nav">
            <div class="month-selector">
                <label><i class="fas fa-calendar-alt"></i> Select Month & Year:</label>
            </div>
            
            <div class="date-selectors">
                <select id="monthSelect" class="month-select">
                    <option value="January">January</option>
                    <option value="February">February</option>
                    <option value="March">March</option>
                    <option value="April">April</option>
                    <option value="May">May</option>
                    <option value="June">June</option>
                    <option value="July">July</option>
                    <option value="August">August</option>
                    <option value="September">September</option>
                    <option value="October">October</option>
                    <option value="November">November</option>
                    <option value="December">December</option>
                </select>
                
                <select id="yearSelect" class="year-select">
                    <!-- Years will be populated by JavaScript -->
                </select>
            </div>

            <div class="current-month-display" id="currentMonthDisplay">
                <!-- Current selected month will be shown here -->
            </div>

            <div class="month-navigation">
                <button class="nav-btn prev" onclick="navigateMonth(-1)">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <button class="nav-btn" onclick="goToCurrentMonth()">
                    <i class="fas fa-calendar-day"></i> Today
                </button>
                <button class="nav-btn next" onclick="navigateMonth(1)">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="stat-card salary">
                <i class="fas fa-money-bill-wave" style="color: #4CAF50;"></i>
                <h3>Total Credited Salary</h3>
                <div class="amount" id="salaryLbl">‚Çπ0</div>
            </div>
            <div class="stat-card expense">
                <i class="fas fa-credit-card" style="color: #f44336;"></i>
                <h3>Total Expenses</h3>
                <div class="amount" id="expLbl">‚Çπ0</div>
            </div>
            <div class="stat-card savings">
                <i class="fas fa-piggy-bank" style="color: #2196F3;"></i>
                <h3>Monthly Savings</h3>
                <div class="amount" id="savLbl">‚Çπ0</div>
            </div>
            <div class="stat-card balance">
                <i class="fas fa-university" style="color: #FF9800;"></i>
                <h3>Bank Balance</h3>
                <div class="amount" id="bankBalanceLbl">‚Çπ0</div>
            </div>
        </div>

        <div class="main-content">
            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('salary')">
                        <i class="fas fa-plus-circle"></i> Salary
                    </button>
                    <button class="tab" onclick="switchTab('expense')">
                        <i class="fas fa-minus-circle"></i> Expense
                    </button>
                    <button class="tab" onclick="switchTab('savings')">
                        <i class="fas fa-chart-pie"></i> Analytics
                    </button>
                </div>

                <div id="salary-tab" class="tab-content active">
                    <h3><i class="fas fa-money-bill-wave"></i> Add Salary Credit</h3>
                    <div class="form-group">
                        <label for="creditAmt">Salary Amount (‚Çπ)</label>
                        <input type="number" id="creditAmt" placeholder="Enter your salary amount">
                    </div>
                    <button class="btn btn-primary" onclick="addCredit()">
                        <i class="fas fa-plus"></i> Credit Salary
                    </button>
                </div>

                <div id="expense-tab" class="tab-content">
                    <h3><i class="fas fa-receipt"></i> Add Expense</h3>
                    <div class="form-group">
                        <label for="expenseDesc">Expense Description</label>
                        <input type="text" id="expenseDesc" placeholder="What did you spend on?">
                    </div>
                    <div class="form-group">
                        <label for="expenseCategory">Category</label>
                        <select id="expenseCategory" onchange="updateSubcategories()">
                            <option value="">Select Category</option>
                            <option value="Food & Dining">üçΩÔ∏è Food & Dining</option>
                            <option value="Transportation">üöó Transportation</option>
                            <option value="Shopping">üõí Shopping</option>
                            <option value="Entertainment">üé¨ Entertainment</option>
                            <option value="Bills & Utilities">üí° Bills & Utilities</option>
                            <option value="Healthcare">üè• Healthcare</option>
                            <option value="Education">üìö Education</option>
                            <option value="Travel">‚úàÔ∏è Travel</option>
                            <option value="EMI/Loans">üè¶ EMI/Loans</option>
                            <option value="Investments">üìà Investments</option>
                            <option value="Others">üìã Others</option>
                        </select>
                        <select id="expenseSubcategory" class="subcategory-select">
                            <option value="">Select Subcategory</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expenseAmt">Amount (‚Çπ)</label>
                        <input type="number" id="expenseAmt" placeholder="Enter amount">
                    </div>
                    <button class="btn btn-primary" onclick="addExpense()">
                        <i class="fas fa-plus"></i> Add Expense
                    </button>
                </div>

                <div id="savings-tab" class="tab-content">
                    <h3><i class="fas fa-chart-pie"></i> Monthly Analytics</h3>
                    <div class="chart-wrapper">
                        <canvas id="pieChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="charts-container">
                <h3><i class="fas fa-analytics"></i> Financial Overview</h3>
                <div class="chart-wrapper">
                    <canvas id="doughnutChart"></canvas>
                </div>
            </div>
        </div>

        <div class="expenses-list">
            <h3><i class="fas fa-list-alt"></i> Expense History</h3>
            <div id="expensesList"></div>
        </div>

        <!-- Enhanced Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-main">
                    <span>Made with</span>
                    <span class="heart">‚ù§Ô∏è</span>
                    <span>by</span>
                    <span class="developer-name">Karan Pardeshi</span>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Enhanced Database System with Multiple Storage Options
        class AdvancedExpenseDB {
            constructor() {
                this.dbName = 'ExpenseTrackerDB';
                this.version = 2;
                this.db = null;
                this.dbType = 'unknown';
                this.isOnline = navigator.onLine;
                this.apiKey = 'your-firebase-api-key'; // Replace with your Firebase API key
                this.firebaseUrl = 'https://your-project.firebaseio.com'; // Replace with your Firebase URL
                this.retryAttempts = 3;
                this.retryDelay = 1000;
                
                // Listen for online/offline events
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateDBStatus('online', 'Online');
                    this.syncOfflineData();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateDBStatus('disconnected', 'Offline Mode');
                });
            }
            
            async init() {
                try {
                    // Try IndexedDB first
                    if (this.supportsIndexedDB()) {
                        await this.initIndexedDB();
                        this.dbType = 'indexeddb';
                        this.updateDBStatus('connected', 'IndexedDB');
                        return true;
                    }
                    
                    // Fallback to localStorage
                    if (this.supportsLocalStorage()) {
                        this.dbType = 'localstorage';
                        this.updateDBStatus('connected', 'LocalStorage');
                        return true;
                    }
                    
                    throw new Error('No storage method available');
                } catch (error) {
                    console.error('Database initialization failed:', error);
                    this.dbType = 'none';
                    this.updateDBStatus('disconnected', 'Storage Failed');
                    return false;
                }
            }
            
            supportsIndexedDB() {
                return 'indexedDB' in window && indexedDB !== null;
            }
            
            supportsLocalStorage() {
                try {
                    const test = 'test';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch(e) {
                    return false;
                }
            }
            
            async initIndexedDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Create expenses store
                        if (!db.objectStoreNames.contains('expenses')) {
                            const expenseStore = db.createObjectStore('expenses', { keyPath: 'id' });
                            expenseStore.createIndex('username', 'username', { unique: false });
                            expenseStore.createIndex('timestamp', 'timestamp', { unique: false });
                        }
                        
                        // Create users store
                        if (!db.objectStoreNames.contains('users')) {
                            const userStore = db.createObjectStore('users', { keyPath: 'username' });
                            userStore.createIndex('email', 'email', { unique: false });
                        }
                        
                        // Create sync queue for offline support
                        if (!db.objectStoreNames.contains('syncQueue')) {
                            const syncStore = db.createObjectStore('syncQueue', { keyPath: 'id', autoIncrement: true });
                            syncStore.createIndex('timestamp', 'timestamp', { unique: false });
                            syncStore.createIndex('synced', 'synced', { unique: false });
                        }
                    };
                });
            }
            
            updateDBStatus(status, text) {
                const statusElement = document.getElementById('dbStatus');
                const statusText = document.getElementById('dbStatusText');
                
                if (statusElement && statusText) {
                    statusElement.className = `db-status ${status}`;
                    statusText.textContent = text;
                }
            }
            
            async saveUserData(username, data, skipSync = false) {
                const timestamp = Date.now();
                const dataWithMeta = {
                    id: username,
                    username,
                    data,
                    timestamp,
                    lastModified: timestamp
                };
                
                try {
                    if (this.dbType === 'indexeddb') {
                        const transaction = this.db.transaction(['expenses'], 'readwrite');
                        const store = transaction.objectStore('expenses');
                        await this.promisifyRequest(store.put(dataWithMeta));
                    } else if (this.dbType === 'localstorage') {
                        localStorage.setItem(`expData_${username}`, JSON.stringify(dataWithMeta));
                    }
                    
                    // Add to sync queue if online sync is enabled and not already syncing
                    if (!skipSync && this.isOnline) {
                        await this.queueForSync('save_user_data', { username, data, timestamp });
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Failed to save user data:', error);
                    // Fallback to localStorage if IndexedDB fails
                    if (this.dbType === 'indexeddb') {
                        try {
                            localStorage.setItem(`expData_${username}`, JSON.stringify(dataWithMeta));
                            this.dbType = 'localstorage';
                            this.updateDBStatus('connected', 'LocalStorage (Fallback)');
                            return true;
                        } catch (fallbackError) {
                            console.error('Fallback save also failed:', fallbackError);
                        }
                    }
                    return false;
                }
            }
            
            async getUserData(username) {
                try {
                    if (this.dbType === 'indexeddb') {
                        const transaction = this.db.transaction(['expenses'], 'readonly');
                        const store = transaction.objectStore('expenses');
                        const request = store.get(username);
                        const result = await this.promisifyRequest(request);
                        return result?.data || {};
                    } else if (this.dbType === 'localstorage') {
                        const data = localStorage.getItem(`expData_${username}`);
                        return data ? JSON.parse(data).data || {} : {};
                    }
                    return {};
                } catch (error) {
                    console.error('Failed to get user data:', error);
                    return {};
                }
            }
            
            async saveUser(username, userData) {
                const userWithMeta = {
                    username,
                    ...userData,
                    createdAt: userData.createdAt || Date.now(),
                    lastLogin: Date.now()
                };
                
                try {
                    if (this.dbType === 'indexeddb') {
                        const transaction = this.db.transaction(['users'], 'readwrite');
                        const store = transaction.objectStore('users');
                        await this.promisifyRequest(store.put(userWithMeta));
                    } else if (this.dbType === 'localstorage') {
                        const users = JSON.parse(localStorage.getItem('expenseUsers') || '{}');
                        users[username] = userWithMeta;
                        localStorage.setItem('expenseUsers', JSON.stringify(users));
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Failed to save user:', error);
                    return false;
                }
            }
            
            async getUser(username) {
                try {
                    if (this.dbType === 'indexeddb') {
                        const transaction = this.db.transaction(['users'], 'readonly');
                        const store = transaction.objectStore('users');
                        const request = store.get(username);
                        return await this.promisifyRequest(request);
                    } else if (this.dbType === 'localstorage') {
                        const users = JSON.parse(localStorage.getItem('expenseUsers') || '{}');
                        return users[username] || null;
                    }
                    return null;
                } catch (error) {
                    console.error('Failed to get user:', error);
                    return null;
                }
            }
            
            async queueForSync(action, data) {
                if (this.dbType !== 'indexeddb') return;
                
                try {
                    const syncItem = {
                        action,
                        data,
                        timestamp: Date.now(),
                        synced: false,
                        retries: 0
                    };
                    
                    const transaction = this.db.transaction(['syncQueue'], 'readwrite');
                    const store = transaction.objectStore('syncQueue');
                    await this.promisifyRequest(store.add(syncItem));
                } catch (error) {
                    console.error('Failed to queue for sync:', error);
                }
            }
            
            async syncOfflineData() {
                if (this.dbType !== 'indexeddb' || !this.isOnline) return;
                
                try {
                    const transaction = this.db.transaction(['syncQueue'], 'readwrite');
                    const store = transaction.objectStore('syncQueue');
                    const index = store.index('synced');
                    const request = index.getAll(false);
                    const unsyncedItems = await this.promisifyRequest(request);
                    
                    for (const item of unsyncedItems) {
                        try {
                            // Simulate cloud sync (replace with actual cloud service)
                            await this.syncToCloud(item);
                            
                            // Mark as synced
                            item.synced = true;
                            item.syncedAt = Date.now();
                            await this.promisifyRequest(store.put(item));
                            
                        } catch (syncError) {
                            console.error('Failed to sync item:', syncError);
                            item.retries = (item.retries || 0) + 1;
                            
                            if (item.retries < this.retryAttempts) {
                                await this.promisifyRequest(store.put(item));
                            } else {
                                console.error('Max retries exceeded for sync item:', item);
                            }
                        }
                    }
                } catch (error) {
                    console.error('Failed to sync offline data:', error);
                }
            }
            
            async syncToCloud(item) {
                // Placeholder for cloud sync functionality
                // Replace this with actual Firebase, Supabase, or other cloud service integration
                return new Promise((resolve) => {
                    setTimeout(() => {
                        console.log('Synced to cloud:', item.action);
                        resolve(true);
                    }, 100);
                });
            }
            
            async exportData(username) {
                try {
                    const userData = await this.getUserData(username);
                    const user = await this.getUser(username);
                    
                    const exportData = {
                        user: user,
                        expenses: userData,
                        exportedAt: new Date().toISOString(),
                        appVersion: '2.0.0'
                    };
                    
                    return exportData;
                } catch (error) {
                    console.error('Failed to export data:', error);
                    return null;
                }
            }
            
            async importData(username, importData) {
                try {
                    if (importData.user) {
                        await this.saveUser(username, importData.user);
                    }
                    
                    if (importData.expenses) {
                        await this.saveUserData(username, importData.expenses, true);
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Failed to import data:', error);
                    return false;
                }
            }
            
            promisifyRequest(request) {
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async clearUserData(username) {
                try {
                    if (this.dbType === 'indexeddb') {
                        const transaction = this.db.transaction(['expenses', 'users'], 'readwrite');
                        const expenseStore = transaction.objectStore('expenses');
                        const userStore = transaction.objectStore('users');
                        
                        await this.promisifyRequest(expenseStore.delete(username));
                        await this.promisifyRequest(userStore.delete(username));
                    } else if (this.dbType === 'localstorage') {
                        localStorage.removeItem(`expData_${username}`);
                        const users = JSON.parse(localStorage.getItem('expenseUsers') || '{}');
                        delete users[username];
                        localStorage.setItem('expenseUsers', JSON.stringify(users));
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Failed to clear user data:', error);
                    return false;
                }
            }
        }

        // Initialize enhanced database
        const expenseDB = new AdvancedExpenseDB();
        let dbInitialized = false;

        // Mobile viewport fix
        function setMobileViewport() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        window.addEventListener('resize', setMobileViewport);
        window.addEventListener('orientationchange', setMobileViewport);
        setMobileViewport();

        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        
        let now = new Date();
        let currentSelectedMonth = months[now.getMonth()];
        let currentSelectedYear = now.getFullYear();
        let curMonth = `${currentSelectedMonth}-${currentSelectedYear}`;
        
        let pieChart, barChart, doughnutChart;
        let currentUser = null;
        let isLoginMode = true;

        const subcategories = {
            "Food & Dining": ["Restaurants", "Fast Food", "Groceries", "Snacks", "Coffee/Tea", "Alcohol", "Home Cooking"],
            "Transportation": ["Fuel/Gas", "Public Transport", "Taxi/Uber", "Car Maintenance", "Parking", "Tolls"],
            "Shopping": ["Clothing", "Electronics", "Home Items", "Books", "Gifts", "Personal Care", "Online Shopping"],
            "Entertainment": ["Movies", "Games", "Sports", "Concerts", "Streaming Services", "Hobbies", "Events"],
            "Bills & Utilities": ["Electricity", "Water", "Gas", "Internet", "Phone", "TV/Cable", "Insurance"],
            "Healthcare": ["Doctor Visits", "Medicines", "Dental", "Hospital", "Health Insurance", "Fitness"],
            "Education": ["Tuition Fees", "Books", "Online Courses", "Training", "Certification", "School Supplies"],
            "Travel": ["Flights", "Hotels", "Local Transport", "Food", "Activities", "Visa/Documents"],
            "EMI/Loans": ["Home Loan", "Car Loan", "Personal Loan", "Credit Card", "Education Loan"],
            "Investments": ["Stocks", "Mutual Funds", "Fixed Deposits", "SIP", "Gold", "Real Estate"],
            "Others": ["Charity", "Gifts", "Miscellaneous", "Emergency", "Repairs", "Services"]
        };

        // Initialize database
        async function initDB() {
            if (!dbInitialized) {
                try {
                    dbInitialized = await expenseDB.init();
                    if (dbInitialized) {
                        console.log('Database initialized successfully');
                    }
                } catch (error) {
                    console.error('Database initialization failed:', error);
                    dbInitialized = false;
                }
            }
            return dbInitialized;
        }

        // Initialize month and year selectors
        function initializeDateSelectors() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            
            // Populate years (5 years ago to 5 years ahead)
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            for (let year = currentYear - 5; year <= currentYear + 5; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
            
            // Set current selections
            monthSelect.value = currentSelectedMonth;
            yearSelect.value = currentSelectedYear;
            
            // Update display
            updateCurrentMonthDisplay();
            
            // Add event listeners
            monthSelect.addEventListener('change', onMonthYearChange);
            yearSelect.addEventListener('change', onMonthYearChange);
        }

        function onMonthYearChange() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            
            currentSelectedMonth = monthSelect.value;
            currentSelectedYear = parseInt(yearSelect.value);
            curMonth = `${currentSelectedMonth}-${currentSelectedYear}`;
            
            updateCurrentMonthDisplay();
            updateDisplay();
            showNotification(`Switched to ${currentSelectedMonth} ${currentSelectedYear}`);
        }

        function updateCurrentMonthDisplay() {
            const display = document.getElementById('currentMonthDisplay');
            display.textContent = `${currentSelectedMonth} ${currentSelectedYear}`;
        }

        function navigateMonth(direction) {
            let monthIndex = months.indexOf(currentSelectedMonth);
            let year = currentSelectedYear;
            
            monthIndex += direction;
            
            if (monthIndex < 0) {
                monthIndex = 11;
                year--;
            } else if (monthIndex > 11) {
                monthIndex = 0;
                year++;
            }
            
            currentSelectedMonth = months[monthIndex];
            currentSelectedYear = year;
            curMonth = `${currentSelectedMonth}-${currentSelectedYear}`;
            
            // Update selectors
            document.getElementById('monthSelect').value = currentSelectedMonth;
            document.getElementById('yearSelect').value = currentSelectedYear;
            
            updateCurrentMonthDisplay();
            updateDisplay();
            showNotification(`Switched to ${currentSelectedMonth} ${currentSelectedYear}`);
        }

        function goToCurrentMonth() {
            const now = new Date();
            currentSelectedMonth = months[now.getMonth()];
            currentSelectedYear = now.getFullYear();
            curMonth = `${currentSelectedMonth}-${currentSelectedYear}`;
            
            // Update selectors
            document.getElementById('monthSelect').value = currentSelectedMonth;
            document.getElementById('yearSelect').value = currentSelectedYear;
            
            updateCurrentMonthDisplay();
            updateDisplay();
            showNotification(`Switched to current month: ${currentSelectedMonth} ${currentSelectedYear}`);
        }

        function switchLoginTab(mode) {
            isLoginMode = mode === 'login';
            document.querySelectorAll('.login-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const emailGroup = document.getElementById('emailGroup');
            const submitText = document.getElementById('submitText');
            
            if (isLoginMode) {
                emailGroup.style.display = 'none';
                submitText.innerHTML = 'Login';
            } else {
                emailGroup.style.display = 'block';
                submitText.innerHTML = 'Register';
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const email = document.getElementById('email').value.trim();

            if (!username || !password) {
                showNotification('Please fill in all required fields!', 'error');
                return;
            }

            const dbReady = await initDB();
            if (!dbReady) {
                showNotification('Database not available. Some features may not work properly.', 'error');
            }

            if (isLoginMode) {
                // Login Logic
                const user = await expenseDB.getUser(username);
                if (user && user.password === password) {
                    currentUser = username;
                    localStorage.setItem('currentUser', username);
                    
                    // Update last login
                    user.lastLogin = Date.now();
                    await expenseDB.saveUser(username, user);                
					// Show main app and update UI
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainApp').classList.add('show');
                    document.getElementById('currentUser').textContent = username;
                    initializeDateSelectors();
                    updateDisplay();
                    showNotification(`Welcome back, ${username}!`, 'success');
                } else {
                    showNotification('Invalid username or password', 'error');
                }
            } else {
                // Register Logic
                if (!email) {
                    showNotification('Email is required for registration', 'error');
                    return;
                }
                const existingUser = await expenseDB.getUser(username);
                if (existingUser) {
                    showNotification('Username already exists', 'error');
                    return;
                }
                const userData = {
                    password,
                    email,
                    createdAt: Date.now()
                };
                const saved = await expenseDB.saveUser(username, userData);
                if (saved) {
                    currentUser = username;
                    localStorage.setItem('currentUser', username);
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainApp').classList.add('show');
                    document.getElementById('currentUser').textContent = username;
                    initializeDateSelectors();
                    updateDisplay();
                    showNotification(`Registered successfully as ${username}!`, 'success');
                } else {
                    showNotification('Registration failed. Please try again.', 'error');
                }
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        async function updateDisplay() {
            if (!currentUser) return;
            const userData = await expenseDB.getUserData(currentUser);
            const monthData = userData[curMonth] || { salary: 0, expenses: [], savings: 0, bankBalance: 0 };

            // Update stat cards
            document.getElementById('salaryLbl').textContent = `‚Çπ${monthData.salary || 0}`;
            document.getElementById('expLbl').textContent = `‚Çπ${monthData.expenses.reduce((sum, exp) => sum + (exp.amount || 0), 0)}`;
            document.getElementById('savLbl').textContent = `‚Çπ${monthData.savings || 0}`;
            document.getElementById('bankBalanceLbl').textContent = `‚Çπ${monthData.bankBalance || 0}`;

            // Update expense list
            const expensesList = document.getElementById('expensesList');
            expensesList.innerHTML = '';
            monthData.expenses.forEach((expense, index) => {
                const expenseItem = document.createElement('div');
                expenseItem.className = `expense-item ${expense.paid ? 'paid' : ''}`;
                expenseItem.innerHTML = `
                    <div class="expense-details">
                        <div class="expense-desc">${expense.description}</div>
                        <div class="expense-category">${expense.category}
                            ${expense.subcategory ? `<span class="expense-subcategory">${expense.subcategory}</span>` : ''}
                        </div>
                        <div class="expense-amount">‚Çπ${expense.amount}</div>
                    </div>
                    <div class="expense-actions">
                        <button class="btn btn-small btn-success" onclick="togglePaid(${index})">${expense.paid ? 'Unmark Paid' : 'Mark Paid'}</button>
                        <button class="btn btn-small btn-danger" onclick="deleteExpense(${index})">Delete</button>
                    </div>
                `;
                expensesList.appendChild(expenseItem);
            });

            // Update charts
            updateCharts(monthData);
        }

        function updateSubcategories() {
            const categorySelect = document.getElementById('expenseCategory');
            const subcategorySelect = document.getElementById('expenseSubcategory');
            const category = categorySelect.value;
            subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
            if (category && subcategories[category]) {
                subcategorySelect.classList.add('show');
                subcategories[category].forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub;
                    option.textContent = sub;
                    subcategorySelect.appendChild(option);
                });
            } else {
                subcategorySelect.classList.remove('show');
            }
        }

        async function addCredit() {
            const amount = parseFloat(document.getElementById('creditAmt').value);
            if (!amount || amount <= 0) {
                showNotification('Please enter a valid salary amount', 'error');
                return;
            }
            const userData = await expenseDB.getUserData(currentUser);
            const monthData = userData[curMonth] || { salary: 0, expenses: [], savings: 0, bankBalance: 0 };
            monthData.salary = (monthData.salary || 0) + amount;
            monthData.savings = (monthData.savings || 0) + amount;
            monthData.bankBalance = (monthData.bankBalance || 0) + amount;
            userData[curMonth] = monthData;
            await expenseDB.saveUserData(currentUser, userData);
            document.getElementById('creditAmt').value = '';
            updateDisplay();
            showNotification('Salary credited successfully', 'success');
        }

        async function addExpense() {
            const description = document.getElementById('expenseDesc').value.trim();
            const category = document.getElementById('expenseCategory').value;
            const subcategory = document.getElementById('expenseSubcategory').value;
            const amount = parseFloat(document.getElementById('expenseAmt').value);
            if (!description || !category || !amount || amount <= 0) {
                showNotification('Please fill in all required fields with valid data', 'error');
                return;
            }
            const userData = await expenseDB.getUserData(currentUser);
            const monthData = userData[curMonth] || { salary: 0, expenses: [], savings: 0, bankBalance: 0 };
            monthData.expenses.push({
                description,
                category,
                subcategory: subcategory || null,
                amount,
                paid: false,
                timestamp: Date.now()
            });
            monthData.savings = (monthData.savings || 0) - amount;
            monthData.bankBalance = (monthData.bankBalance || 0) - amount;
            userData[curMonth] = monthData;
            await expenseDB.saveUserData(currentUser, userData);
            document.getElementById('expenseDesc').value = '';
            document.getElementById('expenseCategory').value = '';
            document.getElementById('expenseSubcategory').value = '';
            document.getElementById('expenseAmt').value = '';
            updateSubcategories();
            updateDisplay();
            showNotification('Expense added successfully', 'success');
        }

        async function togglePaid(index) {
            const userData = await expenseDB.getUserData(currentUser);
            const monthData = userData[curMonth];
            if (monthData && monthData.expenses[index]) {
                monthData.expenses[index].paid = !monthData.expenses[index].paid;
                await expenseDB.saveUserData(currentUser, userData);
                updateDisplay();
                showNotification(`Expense marked as ${monthData.expenses[index].paid ? 'paid' : 'unpaid'}`, 'success');
            }
        }

        async function deleteExpense(index) {
            const userData = await expenseDB.getUserData(currentUser);
            const monthData = userData[curMonth];
            if (monthData && monthData.expenses[index]) {
                const amount = monthData.expenses[index].amount;
                monthData.expenses.splice(index, 1);
                monthData.savings = (monthData.savings || 0) + amount;
                monthData.bankBalance = (monthData.bankBalance || 0) + amount;
                userData[curMonth] = monthData;
                await expenseDB.saveUserData(currentUser, userData);
                updateDisplay();
                showNotification('Expense deleted successfully', 'success');
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
        }

        async function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('mainApp').classList.remove('show');
            document.getElementById('loginScreen').style.display = 'flex';
            showNotification('Logged out successfully', 'success');
        }

        function updateCharts(monthData) {
            const expenseByCategory = {};
            monthData.expenses.forEach(exp => {
                expenseByCategory[exp.category] = (expenseByCategory[exp.category] || 0) + exp.amount;
            });

            const categories = Object.keys(expenseByCategory);
            const amounts = Object.values(expenseByCategory);

            // Destroy existing charts to prevent memory leaks
            if (pieChart) pieChart.destroy();
            if (barChart) barChart.destroy();
            if (doughnutChart) doughnutChart.destroy();

            // Pie Chart
            pieChart = new Chart(document.getElementById('pieChart'), {
                type: 'pie',
                data: {
                    labels: categories,
                    datasets: [{
                        data: amounts,
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF', '#E7E9ED'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Bar Chart
            barChart = new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Expenses by Category',
                        data: amounts,
                        backgroundColor: '#667eea',
                        borderColor: '#764ba2',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Doughnut Chart
            doughnutChart = new Chart(document.getElementById('doughnutChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Salary', 'Expenses', 'Savings'],
                    datasets: [{
                        data: [
                            monthData.salary || 0,
                            monthData.expenses.reduce((sum, exp) => sum + exp.amount, 0),
                            monthData.savings || 0
                        ],
                        backgroundColor: ['#4CAF50', '#f44336', '#2196F3']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // Initialize app on load
        window.onload = async () => {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                const user = await expenseDB.getUser(savedUser);
                if (user) {
                    currentUser = savedUser;
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainApp').classList.add('show');
                    document.getElementById('currentUser').textContent = savedUser;
                    initializeDateSelectors();
                    updateDisplay();
                }
            }
            await initDB();
        };
    </script>
</body>
</html>
